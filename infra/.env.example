# Compose env vars (copy to .env before running docker compose)

# Core services
DATABASE_URL=postgres://postgres:postgres@timescaledb:5432/anomalies
KAFKA_BROKERS=redpanda:29092
KAFKA_AUTO_OFFSET_RESET=latest
REDIS_URL=redis://redis:6379/0
ENABLE_DB_INIT=false
PROCESSOR_CONSUMER_GROUP=processor
ALLOWED_ORIGINS=*

# Streams
BINANCE_STREAM=wss://stream.binance.com:9443/stream
SYMBOLS=btcusdt,ethusdt
NEWS_RSS=https://www.coindesk.com/arc/outboundfeeds/rss/
NEWS_RSS_URLS=
RSS_DEFAULT_TITLE=untitled
RSS_DEFAULT_SOURCE=rss
NEWS_ENRICHED_TOPIC=news-enriched
NEWS_DLQ_TOPIC=news-deadletter

# Anomaly thresholds
ALERT_THRESHOLD_1M=0.05
ALERT_THRESHOLD_5M=0.08
ALERT_THRESHOLD_15M=0.12
ANOMALY_TEST_MODE=false
ANOMALY_TEST_THRESHOLD=0.001
ANOMALY_TEST_COOLDOWN_SEC=0

# Processor reliability defaults
HEADLINE_MAX_AGE_SEC=900
HEADLINE_STALE_WARN_SEC=300
NEWS_STALE_LOG_EVERY=10
RSS_SEEN_TTL_SEC=86400
RSS_SEEN_MAX=5000
SUMMARIES_DLQ_TOPIC=summaries-deadletter
SUMMARY_DLQ_BUFFER_PATH=summary_dlq_buffer.jsonl
SUMMARY_DLQ_BUFFER_MAX_BYTES=52428800
RETENTION_PRICES_DAYS=
RETENTION_METRICS_DAYS=
RETENTION_HEADLINES_DAYS=
RETENTION_ANOMALIES_DAYS=
SUMMARY_LLM_CONCURRENCY=2
TASK_RESTART_BACKOFF_SEC=2
TASK_RESTART_MAX_PER_MIN=10
SIDECAR_RESTART_BACKOFF_SEC=2
SIDECAR_RESTART_MAX_PER_MIN=10
PROCESSOR_METRICS_HOST=0.0.0.0
PROCESSOR_METRICS_PORT=9102
SUMMARY_METRICS_HOST=0.0.0.0
SUMMARY_METRICS_PORT=
WINDOW_MAX_GAP_FACTOR=1.5
VOL_MAX_GAP_FACTOR=
VOL_RESAMPLE_SEC=5
WINDOW_HISTORY_MAXLEN=300
WINDOW_LABELS=1m,5m,15m
LATE_PRICE_TOLERANCE_SEC=0
ANOMALY_COOLDOWN_SEC=60
BAD_PRICE_LOG_EVERY=50
LATE_PRICE_LOG_EVERY=50
PRICE_PUBLISH_LOG_EVERY=500
NEWS_PUBLISH_LOG_EVERY=200
PRICE_FAILURE_LOG_EVERY=5
NEWS_FAILURE_LOG_EVERY=3
INGEST_STUCK_LOG_EVERY=100
PRICE_BACKOFF_FAILURES_THRESHOLD=5
PRICE_BACKOFF_BASE_SEC=1
PRICE_BACKOFF_BASE_AFTER_FAILURES_SEC=2
PRICE_BACKOFF_CAP_SEC=60
NEWS_BACKOFF_FAILURES_THRESHOLD=5
NEWS_BACKOFF_BASE_SEC=5
NEWS_BACKOFF_BASE_AFTER_FAILURES_SEC=10
NEWS_BACKOFF_CAP_SEC=90
NEWS_POLL_INTERVAL_SEC=60
NEWS_BATCH_LIMIT=20
RETRY_MAX_ATTEMPTS=3
RETRY_BACKOFF_BASE_SEC=1
RETRY_BACKOFF_CAP_SEC=30
RETRY_JITTER_MIN=0.5
RETRY_JITTER_MAX=1.5
EWMA_Z_CAP=6.0
PERCENTILE_MIN_SAMPLES=3
ALERT_LOG_EVERY=50

# LLM
LLM_PROVIDER=stub
LLM_MAX_TOKENS=80
LLM_TEMPERATURE=0.3
LLM_FALLBACK_LOG_EVERY=100
ANOMALY_HOTPATH_STUB_SUMMARY=true
OPENAI_MODEL=
GOOGLE_MODEL=
OPENAI_API_KEY=
GOOGLE_API_KEY=

# Sentiment sidecar
SENTIMENT_PROVIDER=stub
# Model assets live at SENTIMENT_MODEL_PATH (default: /models/finbert).
# Expected files: model.onnx, tokenizer.json or vocab.txt, config.json, etc.
# Override this path if you keep models elsewhere.
SENTIMENT_MODEL_PATH=/models/finbert
SENTIMENT_BATCH_SIZE=16
SENTIMENT_POLL_TIMEOUT_MS=500
SENTIMENT_MAX_LATENCY_MS=
SENTIMENT_FALLBACK_ON_SLOW=false
SENTIMENT_FALLBACK_LOG_EVERY=100
SENTIMENT_FAIL_FAST=false
SENTIMENT_LIGHT_RUNTIME=false
SENTIMENT_POS_THRESHOLD=0.2
SENTIMENT_NEG_THRESHOLD=-0.2
SENTIMENT_MAX_SEQ_LEN=512
SENTIMENT_METRICS_HOST=0.0.0.0
SENTIMENT_METRICS_PORT=9101
SENTIMENT_SIDECAR_GROUP=sentiment-sidecar

# Frontend
NEXT_PUBLIC_API_BASE=http://localhost:8000
NEXT_PUBLIC_WS_BASE=ws://localhost:8000
